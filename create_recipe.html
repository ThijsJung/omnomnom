<!DOCTYPE html>
<html>
    <head lang="en">
        <title>Omnomnom</title>
        <meta charset="utf-8" />
    </head>
    <body>
        <div>
            <form id="recipeForm">
                <h3>Recipe details</h3>
                <div>
                    <label for="recipeTitle">Title:</label>
                    <input class="recipeDetails" name="recipeTitle" data-attribute_name="title">
                </div>
                <div>
                    <label for="recipeDescription">Description:</label>
                    <textarea cols="30" rows="8" class="recipeDetails" name="recipeDescription" data-attribute_name="description"></textarea>
                </div>
                <div>
                    <label for="preparationTime">Preparation time (hour:minute):</label>
                    <input class="recipeDetails" name="preparationTime" data-attribute_name="prep_time" type="time">
                </div>
                <div>
                    <label for="CookTime">Cooking time (hour:minute)</label>
                    <input class="recipeDetails" name="CookTime" data-attribute_name="cook_time" type="time">
                </div>
                <div>
                    <label for="hungryPeopleCount">Number of portions:</label>
                    <input class="recipeDetails" name="hungryPeopleCount" data-attribute_name="portion_size" type="number">
                </div>
                <div>
                    <label for="recipeImage">Add picture</label>
                    <input name="recipeImage" data-attribute_name="image_url" type="file">
                </div>
                <h3>Ingredients</h3>
                <ul id="ingredient_list"></ul>
                <h3>Preparation</h3>
                <ol id="preparation"></ol>
                <h3>Protips</h3>
                <ul id="pro_tips"></ul>
                <input type="submit" value="Save">
            </form>
        </div>
        <div id="result"></div>
    </body>
</html>

<script>
    // Access the form element
    let form = document.getElementById("recipeForm");
    let recipe = {};
    form.onsubmit = function(event){
        event.preventDefault();
        // Get recipe details
        recipeDetails = document.getElementsByClassName("recipeDetails");
        for (let recipeDetail of recipeDetails){
            recipe[recipeDetail.dataset.attribute_name] = recipeDetail.value;
        }
        // Get ingredients
        let ingredients = [];
        let ingredientsListItems = document.getElementById("ingredient_list").getElementsByTagName("li");
        for (let ingredientLi of ingredientsListItems) {
            let ingredientInputs = ingredientLi.getElementsByTagName("input");
            let ingredient = {};
            for (let ingredientInput of ingredientInputs) {
                if (ingredientInput.value !== "") {
                    ingredient[ingredientInput.name] = ingredientInput.value;
                }
            }
            ingredients.push(ingredient);
        }
        recipe["ingredients"] = ingredients;

        let result_div = document.getElementById("result");
        result_div.innerHTML = "Your recipe is \n" + JSON.stringify(recipe);
    };

    function add_ingredient(){
        let ingredient_list = document.getElementById("ingredient_list");
        let current_ingredient_id = ingredient_list.getElementsByTagName("li").length;
        let incremented_ingredient_id = current_ingredient_id + 1;
        console.log(incremented_ingredient_id);
        
        // Create ingredient list item
        let ingredient = document.createElement("li");

        let ingredient_fields = [
            {"ui_name": "Ingredient", "label_name": "name"},
            {"ui_name": "Amount", "label_name": "quantity"},
            {"ui_name": "Unit", "label_name": "unit"}
        ];
        // Create three fields for every attribute of the ingredient
        ingredient_fields.forEach(function(element){
            let next_ingredient_id = "ingredient_" + element.label_name + "_" + incremented_ingredient_id;
            // Create ingredient label
            let ingredient_label = document.createElement("label");
            ingredient_label.htmlFor = next_ingredient_id;
            ingredient_label.innerHTML = element.ui_name + ":";
            ingredient.appendChild(ingredient_label);
            
            // Create ingredient text input
            let ingredient_input = document.createElement("input");
            ingredient_input.id = next_ingredient_id;
            ingredient_input.setAttribute("type", "text");
            ingredient_input.setAttribute("name", element.label_name);
            ingredient.appendChild(ingredient_input);
        });
        let add_button = document.createElement("button");
        add_button.innerHTML = "+";
        add_button.id = "ingredient_button_" + incremented_ingredient_id;
        add_button.type = "button";
        add_button.setAttribute("onClick", "add_ingredient()");
        ingredient.appendChild(add_button);
        ingredient_list.appendChild(ingredient);
        
        // Turn + on previous item into -
        if(incremented_ingredient_id > 1){
            let prev_button_id = "ingredient_button_" + current_ingredient_id;
            console.log(prev_button_id);
            let prev_button = document.getElementById(prev_button_id);
            prev_button.innerHTML = "-";
        }
    }
    
    function add_preparation_step(){
        let preparations = document.getElementById("preparation");
        
        // let add_button = document.createElement("button");
        // add_button.innerHTML = "+";
        // add_button.id = "ingredient_button_" + incremented_ingredient_id;
        // add_button.type = "button";
        // add_button.setAttribute("onClick", "add_ingredient()");
        // ingredient.appendChild(add_button);
        // ingredient_list.appendChild(ingredient);
    }
    add_ingredient();
</script>